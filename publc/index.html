<!DOCTYPE html>
<html>
<head>
    <title>Bi-Stable Monitor</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { 
            background-color: #0d1117; 
            color: #c9d1d9; 
            font-family: 'Courier New', monospace; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0;
            position: relative;
            overflow: hidden;
            transition: background-color 0.5s ease;
        }
        
        /* Background decorations container */
        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .bg-decoration.active {
            opacity: 1;
        }
        
        /* Day mode - clouds */
        body.day-mode {
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%);
            color: #333;
        }
        
        /* Day mode HOT - when temp >= 30¬∞C */
        body.day-mode.hot {
            background: linear-gradient(to bottom, #FF6B35 0%, #FFA500 50%, #FFD700 100%);
        }
        
        body.day-mode.hot .cloud {
            opacity: 0.4;
        }
        
        body.day-mode.hot h1 {
            color: #8B0000;
            text-shadow: 0 0 15px #FF4500;
        }
        
        body.day-mode.hot .card {
            background: rgba(255, 140, 0, 0.3);
            border: 2px solid #FF4500;
        }
        
        /* Sun for hot day */
        .sun {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #FFD700;
            box-shadow: 0 0 60px #FFA500, 0 0 100px #FF8C00;
            top: 10%;
            right: 15%;
            animation: sunshine 3s infinite alternate;
        }
        
        @keyframes sunshine {
            from { transform: scale(1); box-shadow: 0 0 60px #FFA500, 0 0 100px #FF8C00; }
            to { transform: scale(1.1); box-shadow: 0 0 80px #FFA500, 0 0 120px #FF8C00; }
        }
        
        .sun::before, .sun::after {
            content: '';
            position: absolute;
            border-radius: 50%;
        }
        
        .sun::before {
            width: 80px;
            height: 80px;
            background: #FFEB3B;
            top: 10px;
            left: 10px;
        }
        
        .sun::after {
            width: 60px;
            height: 60px;
            background: #FFF;
            top: 20px;
            left: 20px;
            opacity: 0.5;
        }
        
        .cloud {
            position: absolute;
            background: white;
            border-radius: 100px;
            opacity: 0.8;
            animation: float 20s infinite linear;
        }
        
        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 100px;
        }
        
        .cloud1 { width: 100px; height: 40px; top: 20%; left: -120px; animation-duration: 25s; }
        .cloud1::before { width: 50px; height: 50px; top: -25px; left: 10px; }
        .cloud1::after { width: 60px; height: 40px; top: -15px; right: 10px; }
        
        .cloud2 { width: 120px; height: 50px; top: 40%; left: -150px; animation-duration: 30s; animation-delay: 5s; }
        .cloud2::before { width: 60px; height: 60px; top: -30px; left: 15px; }
        .cloud2::after { width: 70px; height: 50px; top: -20px; right: 15px; }
        
        .cloud3 { width: 90px; height: 35px; top: 60%; left: -110px; animation-duration: 28s; animation-delay: 10s; }
        .cloud3::before { width: 45px; height: 45px; top: -20px; left: 10px; }
        .cloud3::after { width: 55px; height: 35px; top: -15px; right: 10px; }
        
        @keyframes float {
            to { transform: translateX(calc(100vw + 200px)); }
        }
        
        /* Night mode - stars and moons */
        body.night-mode {
            background: linear-gradient(to bottom, #0a0e27 0%, #1a1f3a 100%);
            color: #c9d1d9;
        }
        
        .moon {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #f4f4f4;
            box-shadow: 0 0 40px rgba(244, 244, 244, 0.8);
            top: 15%;
            right: 10%;
        }
        
        .moon::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #0a0e27;
            top: -10px;
            right: -15px;
        }
        
        .star {
            position: absolute;
            background: white;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Alert mode - danger background */
        body.alert-mode {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 50%, #8B0000 100%);
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }
        
        .danger-icon {
            position: absolute;
            font-size: 60px;
            animation: spin 4s linear infinite, danger-pulse 1s infinite alternate;
            opacity: 0.3;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes danger-pulse {
            from { opacity: 0.2; }
            to { opacity: 0.4; }
        }
        
        .danger-icon:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .danger-icon:nth-child(2) { top: 15%; right: 15%; animation-delay: 0.5s; }
        .danger-icon:nth-child(3) { bottom: 20%; left: 20%; animation-delay: 1s; }
        .danger-icon:nth-child(4) { bottom: 15%; right: 10%; animation-delay: 1.5s; }
        
        h1 { color: #58a6ff; text-shadow: 0 0 10px #58a6ff; z-index: 10; position: relative; transition: color 0.3s ease; }
        body.day-mode h1 { color: #1a5490; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        body.alert-mode h1 { color: #fff; text-shadow: 0 0 20px #ff0000; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 600px; z-index: 10; position: relative; }
        .card { background: #161b22; padding: 20px; border-radius: 12px; border: 1px solid #30363d; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: background 0.3s ease; }
        body.day-mode .card { background: rgba(255, 255, 255, 0.9); border: 1px solid #ccc; color: #333; }
        body.alert-mode .card { background: rgba(139, 0, 0, 0.7); border: 1px solid #ff0000; }
        
        .value { font-size: 40px; font-weight: bold; margin-top: 10px; }
        .temp-val { color: #ff7b72; }
        body.day-mode .temp-val { color: #d32f2f; }
        body.alert-mode .temp-val { color: #ffeb3b; }
        
        .light-val { color: #79c0ff; }
        body.day-mode .light-val { color: #1976d2; }
        body.alert-mode .light-val { color: #ffeb3b; }
        
        .mode-card { grid-column: span 2; }
        .alert { background-color: #7f1d1d; border: 1px solid #ff7b72; animation: flash 0.5s infinite alternate; }
        @keyframes flash { from { opacity: 1; } to { opacity: 0.5; } }
    </style>
</head>
<body>
    <!-- Background decorations for day mode -->
    <div id="dayDecoration" class="bg-decoration">
        <div class="sun" id="sun" style="display: none;"></div>
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
    </div>
    
    <!-- Background decorations for night mode -->
    <div id="nightDecoration" class="bg-decoration">
        <div class="moon"></div>
    </div>
    
    <!-- Background decorations for alert mode -->
    <div id="alertDecoration" class="bg-decoration">
        <div class="danger-icon">‚ö†Ô∏è</div>
        <div class="danger-icon">‚ò¢Ô∏è</div>
        <div class="danger-icon">‚ö†Ô∏è</div>
        <div class="danger-icon">‚ò¢Ô∏è</div>
    </div>
    
    <h1>BI-STABLE MONITOR DASHBOARD</h1>
    
    <div class="dashboard">
        <div class="card">
            <div>TEMPERATURE</div>
            <div class="value temp-val"><span id="temp">--</span>¬∞C</div>
        </div>
        <div class="card">
            <div>LIGHT LEVEL</div>
            <div class="value light-val"><span id="light">--</span></div>
        </div>
        <div class="card mode-card" id="statusCard">
            <div>SYSTEM STATUS</div>
            <div class="value" id="mode">WAITING...</div>
        </div>
    </div>

    <script>
        const socket = io();
        const statusCard = document.getElementById('statusCard');
        const body = document.body;
        const dayDecoration = document.getElementById('dayDecoration');
        const nightDecoration = document.getElementById('nightDecoration');
        const alertDecoration = document.getElementById('alertDecoration');
        
        // Generate random stars for night mode
        function createStars() {
            const starCount = 50;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                nightDecoration.appendChild(star);
            }
        }
        createStars();

        socket.on('sensorData', (data) => {
            document.getElementById('temp').innerText = data.temp;
            document.getElementById('light').innerText = data.light;
            
            const temperature = parseFloat(data.temp);
            const sun = document.getElementById('sun');
            
            // Remove all mode classes
            body.classList.remove('day-mode', 'night-mode', 'alert-mode', 'hot');
            dayDecoration.classList.remove('active');
            nightDecoration.classList.remove('active');
            alertDecoration.classList.remove('active');
            sun.style.display = 'none';
            
            // Logic for visual modes
            if (data.motion === 1 && data.mode === "NIGHT") {
                // ALERT MODE - intruder detected
                document.getElementById('mode').innerText = "‚ö†Ô∏è INTRUDER ALERT ‚ö†Ô∏è";
                statusCard.classList.add("alert");
                body.classList.add('alert-mode');
                alertDecoration.classList.add('active');
            } else {
                document.getElementById('mode').innerText = data.mode + " MODE";
                statusCard.classList.remove("alert");
                
                if (data.mode === "DAY") {
                    // DAY MODE - blue sky with clouds
                    body.classList.add('day-mode');
                    dayDecoration.classList.add('active');
                    
                    // Check if temperature is high (>= 30¬∞C)
                    if (temperature >= 30) {
                        body.classList.add('hot');
                        sun.style.display = 'block';
                        document.getElementById('mode').innerText = "üî• HOT DAY MODE üî•";
                    }
                } else if (data.mode === "NIGHT") {
                    // NIGHT MODE - dark sky with moon and stars
                    body.classList.add('night-mode');
                    nightDecoration.classList.add('active');
                }
            }
        });
    </script>
</body>
</html>